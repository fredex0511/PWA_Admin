<ion-content>
  <div class="history-mobile-container">
    <div class="history-list-card">
      <div class="history-list-header">
        <span class="history-list-title">Historial de Recorridos</span>
      </div>
      <div *ngIf="userRunRoutes && userRunRoutes.length > 0; else noRoutes">
        <div *ngFor="let routeRun of userRunRoutes" class="route-item" (click)="openRouteDetails(routeRun)">
          <div class="route-info">
            <div class="route-nombre">{{ routeRun.route?.name }}</div>
            <div class="route-details">
              <span>Inicio: {{ routeRun.start_time | date: 'short' }}</span>
              <span *ngIf="routeRun.end_time">Fin: {{ routeRun.end_time | date: 'short' }}</span>
              <span *ngIf="routeRun.incidents && routeRun.incidents.length > 0">
                Incidentes: {{ routeRun.incidents.length }}
              </span>
            </div>
          </div>
          <ion-icon name="chevron-forward-outline" class="view-icon"></ion-icon>
        </div>
      </div>
      <ng-template #noRoutes>
        <div class="no-routes-message">
          <p>No hay recorridos registrados</p>
        </div>
      </ng-template>
    </div>
  </div>
</ion-content>

<!-- Modal de detalles -->
<ion-modal [isOpen]="isModalOpen" (didDismiss)="onModalDismiss()" class="route-details-modal">
  <ng-template ionModalContent>
    <ion-header>
      <ion-toolbar color="dark">
        <ion-buttons slot="end">
          <ion-button (click)="closeRouteDetails()">Cerrar</ion-button>
        </ion-buttons>
        <ion-title>Detalles del Recorrido</ion-title>
      </ion-toolbar>
    </ion-header>
    <ion-content *ngIf="selectedRoute" class="modal-content">
      <!-- Informaci贸n General -->
      <div class="details-section">
        <div class="section-title">Informaci贸n General</div>
        <ion-item lines="none">
          <ion-label>
            <div class="label-strong">Ruta:</div>
            <div class="label-value">{{ selectedRoute.route?.name }}</div>
          </ion-label>
        </ion-item>
        <ion-item lines="none">
          <ion-label>
            <div class="label-strong">Usuario:</div>
            <div class="label-value">{{ selectedRoute.user?.name }}</div>
          </ion-label>
        </ion-item>
        <ion-item lines="none">
          <ion-label>
            <div class="label-strong">Inicio:</div>
            <div class="label-value">{{ selectedRoute.start_time | date: 'medium' }}</div>
          </ion-label>
        </ion-item>
        <ion-item lines="none" *ngIf="selectedRoute.end_time">
          <ion-label>
            <div class="label-strong">Fin:</div>
            <div class="label-value">{{ selectedRoute.end_time | date: 'medium' }}</div>
          </ion-label>
        </ion-item>
      </div>

      <!-- Informaci贸n de Origen y Destino -->
      <div class="details-section">
        <div class="section-title">Recorrido</div>
        <ion-item lines="none">
          <ion-label>
            <div class="label-strong">Origen:</div>
            <div class="label-value">{{ selectedRoute.route?.startPlace?.name }}</div>
          </ion-label>
        </ion-item>
        <ion-item lines="none">
          <ion-label>
            <div class="label-strong">Destino:</div>
            <div class="label-value">{{ selectedRoute.route?.endPlace?.name }}</div>
          </ion-label>
        </ion-item>
      </div>

      <!-- Incidentes -->
      <div class="details-section">
        <div class="section-title">
          Incidentes
          <span class="incident-badge" *ngIf="selectedRoute.incidents && selectedRoute.incidents.length > 0">
            {{ selectedRoute.incidents.length }}
          </span>
        </div>
        <div *ngIf="selectedRoute.incidents && selectedRoute.incidents.length > 0; else noIncidents">
          <div *ngFor="let incident of selectedRoute.incidents" class="incident-card">
            <div class="incident-header">
              <span class="incident-date">{{ incident.date | date: 'short' }}</span>
            </div>
            <div class="incident-description" *ngIf="incident.place?.name">
              <strong>Ubicaci贸n:</strong> {{ incident.place?.name }}
            </div>
          </div>
        </div>
        <ng-template #noIncidents>
          <div class="no-items-message">Sin incidentes reportados</div>
        </ng-template>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>