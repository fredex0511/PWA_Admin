<div class="danger-zones-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="title-container">
      <ion-icon name="warning" class="warning-icon"></ion-icon>
      <h1>Zonas Peligrosas</h1>
    </div>
    <div class="stats-container">
      <div class="stat-item">
        <span class="stat-number">{{ dangerZones.length }}</span>
        <span class="stat-label">Zonas Activas</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{ totalIncidents }}</span>
        <span class="stat-label">Incidentes Base</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">50m</span>
        <span class="stat-label">Radio Seguridad</span>
      </div>
    </div>
  </div>

  <!-- Map Container -->
  <div class="map-container">
    <div class="map-header">
      <h2>Mapa de Zonas de Riesgo</h2>
      <div class="map-controls">
        <ion-button fill="clear" size="small" (click)="refreshMap()">
          <ion-icon name="refresh-outline" slot="icon-only"></ion-icon>
        </ion-button>
        <ion-button fill="clear" size="small" (click)="toggleLegend()">
          <ion-icon name="information-circle-outline" slot="icon-only"></ion-icon>
        </ion-button>
        <ion-button fill="clear" size="small" (click)="centerMap()">
          <ion-icon name="locate-outline" slot="icon-only"></ion-icon>
        </ion-button>
      </div>
    </div>

    <!-- Map View -->
    <div class="map-view" id="dangerZonesMap">
      <div class="map-content">
        <!-- Mock Map Background -->
        <div class="map-background"></div>
        
        <!-- Danger Zone Circles -->
        <div *ngFor="let zone of dangerZones; trackBy: trackByZoneId" 
             class="danger-zone-circle"
             [style.left.%]="zone.position.x"
             [style.top.%]="zone.position.y"
             [style.width.px]="getZoneRadius(zone.severity)"
             [style.height.px]="getZoneRadius(zone.severity)"
             [class]="'severity-' + zone.severity"
             (click)="selectZone(zone)"
             [class.selected]="selectedZone?.id === zone.id">
          
          <!-- Zone Center Marker -->
          <div class="zone-marker">
            <ion-icon name="warning" class="marker-icon"></ion-icon>
          </div>
          
          <!-- Zone Radius Indicator -->
          <div class="radius-indicator">
            <span>{{ zone.radius }}m</span>
          </div>
        </div>

        <!-- Selected Zone Details -->
        <div *ngIf="selectedZone" class="zone-details-overlay">
          <div class="zone-details-card">
            <div class="details-header">
              <div class="zone-info">
                <h3>{{ selectedZone.name }}</h3>
                <p class="zone-description">{{ selectedZone.description }}</p>
              </div>
              <div class="severity-badge">
                <ion-badge [color]="getSeverityColor(selectedZone.severity)">
                  {{ getSeverityLabel(selectedZone.severity) }}
                </ion-badge>
              </div>
            </div>
            
            <div class="details-content">
              <div class="detail-row">
                <ion-icon name="location-outline"></ion-icon>
                <span>{{ selectedZone.location }}</span>
              </div>
              <div class="detail-row">
                <ion-icon name="time-outline"></ion-icon>
                <span>Detectada: {{ formatDate(selectedZone.detectedAt) }}</span>
              </div>
              <div class="detail-row">
                <ion-icon name="alert-circle-outline"></ion-icon>
                <span>{{ selectedZone.incidentCount }} incidentes reportados</span>
              </div>
              <div class="detail-row">
                <ion-icon name="resize-outline"></ion-icon>
                <span>Radio de seguridad: {{ selectedZone.radius }}m</span>
              </div>
            </div>

            <button class="close-details" (click)="clearSelection()">
              <ion-icon name="close-outline"></ion-icon>
            </button>
          </div>
        </div>

        <!-- Map Legend -->
        <div class="map-legend" [class.visible]="showLegend">
          <div class="legend-header">
            <h4>Leyenda</h4>
            <button (click)="toggleLegend()">
              <ion-icon name="close-outline"></ion-icon>
            </button>
          </div>
          <div class="legend-items">
            <div class="legend-item">
              <div class="legend-color severity-low"></div>
              <span>Riesgo Bajo</span>
            </div>
            <div class="legend-item">
              <div class="legend-color severity-medium"></div>
              <span>Riesgo Medio</span>
            </div>
            <div class="legend-item">
              <div class="legend-color severity-high"></div>
              <span>Riesgo Alto</span>
            </div>
            <div class="legend-item">
              <div class="legend-color severity-critical"></div>
              <span>Riesgo Cr√≠tico</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Notification Controls -->
    <div class="notification-controls">
      <div class="notification-info">
        <ion-icon name="notifications-outline" class="notification-icon"></ion-icon>
        <div class="notification-text">
          <span class="notification-title">Sistema de Alertas</span>
          <span class="notification-subtitle">Notifica zonas peligrosas a todos los usuarios activos</span>
        </div>
      </div>
      
      <div class="notification-actions">
        <ion-button 
          fill="outline" 
          size="small" 
          (click)="previewNotification()"
          class="preview-btn">
          <ion-icon name="eye-outline" slot="start"></ion-icon>
          Vista Previa
        </ion-button>
        
        <ion-button 
          (click)="sendDangerZoneNotification()" 
          class="notify-btn"
          [disabled]="dangerZones.length === 0">
          <ion-icon name="send-outline" slot="start"></ion-icon>
          Notificar Zonas Peligrosas
        </ion-button>
      </div>
    </div>
  </div>
</div>
